# Xray Checker (Бета-версия)

[English](https://github.com/kutovoys/xray-checker) | [Russian](https://github.com/kutovoys/xray-checker/blob/main/README_RU.md)

## Обзор

Xray Checker — это бета-версия инструмента, предназначенного для тестирования соединений через различные протоколы, такие как VLESS, Trojan и Shadowsocks. Приложение парсит предоставленные конфигурации, создает файлы конфигурации для Xray и затем тестирует подключение через прокси Xray. Если внешний IP-адрес после использования прокси отличается от оригинального, инструмент отправляет результаты в систему мониторинга Uptime Kuma. В настоящее время поддерживается только Uptime Kuma, но в будущем будут добавлены дополнительные провайдеры.

Этот инструмент все еще находится в стадии разработки, и некоторые функции могут быть не полностью реализованы или стабильны. Мы будем рады вашим отзывам и вкладу в улучшение приложения.

## Возможности

- **Поддержка протоколов**: VLESS, Trojan и Shadowsocks.
- **Интеграция с провайдерами**: В настоящее время поддерживается Uptime Kuma, с планами добавить больше провайдеров.
- **Автоматическое тестирование**: Автоматически тестирует соединения и отправляет результаты в систему мониторинга.
- **Поддержка Docker**: Легко развертывается с использованием Docker и Docker Compose.

## Логика тестирования соединения

1. **Парсинг конфигурации**: Приложение парсит предоставленный файл конфигурации для извлечения деталей о тестируемых соединениях.
2. **Создание конфигураций Xray**: На основе полученных данных приложение создает файлы конфигурации для Xray.
3. **Проверка текущего внешнего IP**: Перед началом тестов приложение проверяет текущий внешний IP-адрес.
4. **Запуск Xray с каждой конфигурацией**: Xray запускается с каждым сгенерированным файлом конфигурации.
5. **Проверка IP через прокси Xray**: Внешний IP проверяется снова через прокси Xray, чтобы увидеть, отличается ли он от оригинального.
6. **Отправка данных в систему мониторинга**: Если IP-адреса отличаются, данные отправляются в систему Uptime Kuma.

## Как использовать

### Docker

Вы можете запустить Xray Checker с помощью Docker. Убедитесь, что у вас есть действительный файл `config.json`, содержащий ваши настройки подключения.

```bash
docker run --rm -v ./config.json:/app/config.json kutovoys/xray-checker
```

### Docker Compose

Для более сложных настроек или если вам нужно управлять несколькими сервисами, вы можете использовать Docker Compose. Пример файла docker-compose.yml:

```yaml
services:
  xray-checker:
    image: kutovoys/xray-checker
    container_name: xray-checker
    volumes:
      - ./config.json:/app/config.json
    restart: unless-stopped
```

Для запуска сервиса выполните команду:

```
docker-compose up -d
```

## Конфигурация

Приложению требуется файл config.json, который должен быть смонтирован в контейнер Docker. Этот файл должен содержать необходимую информацию о тестируемых соединениях, включая тип протокола, детали сервера и настройку мониторинга.

Пример файла конфигурации предоставлен в репозитории как config.json.example. Вы можете скопировать этот файл и изменить его в соответствии с вашими потребностями:

```json
{
  "provider": {
    "name": "uptime-kuma",
    "proxyStartPort": 10000,
    "interval": 40,
    "workers": 3,
    "checkIpService": "https://ifconfig.io",
    "configs": [
      {
        "link": "vless://uid@server:port?security=security&type=type&headerType=headerType&flow=flow&path=path&host=host&sni=sni&fp=fp&pbk=pbk&sid=sid#name",
        "monitorLink": "https://uptime-kuma-url/api/push/MonitorID?status=up&msg=OK&ping="
      },
      {
        "link": "trojan://password@server:port?security=security&type=type&headerType=headerType&path=path&host=host&sni=sni&fp=fp#name",
        "monitorLink": "https://uptime-kuma-url/api/push/MonitorID?status=up&msg=OK&ping="
      },
      {
        "link": "ss://methodpassword@server:port#name",
        "monitorLink": "https://uptime-kuma-url/api/push/MonitorID?status=up&msg=OK&ping="
      }
    ]
  }
}
```

Просто переименуйте config.json.example в config.json и настройте значения в соответствии с вашими требованиями.

### Описание параметров

#### provider (объект):

Этот раздел определяет основную информацию о провайдере и параметры тестирования.

- **name**: Имя провайдера мониторинга. В данном примере используется `"uptime-kuma"`, что означает интеграцию с системой мониторинга Uptime Kuma.
- **proxyStartPort**: Начальный порт, используемый для прокси. Определяет первый порт для тестирования Xray. Каждая последующая конфигурация будет использовать следующий порт. Например, если указано `10000`, первое тестирование будет использовать порт `10000`, второе — `10001` и так далее.
- **interval**: Интервал тестирования в секундах. Определяет, как часто приложение будет запускать тесты соединений для всех конфигураций. В данном примере указано `40` секунд.
- **workers**: Количество одновременно работающих воркеров для обработки тестов конфигураций. В примере указано `3`, что означает, что до трех конфигураций могут тестироваться одновременно.
- **checkIpService**: URL сервиса для проверки внешнего IP-адреса. В примере используется `https://ifconfig.io`, который возвращает ваш текущий IP-адрес. Этот сервис используется для получения исходного IP-адреса до и после тестирования через прокси.
- **configs**: Массив объектов конфигураций. Каждый объект описывает параметры для тестирования конкретного соединения.

#### Внутри configs (массив объектов):

Каждая конфигурация содержит информацию о соединении, которое будет тестироваться.

- **link**: Ссылка на соединение, содержащая протокол и детали подключения:
  - **vless://**, **trojan://** или **ss://** — протокол, используемый для соединения.
  - **uid@server:port** — UID (или пароль) для аутентификации, адрес сервера и порт.
  - **URL параметры** (например, security, type, sni, fp, pbk, sid) определяют дополнительные настройки соединения в зависимости от протокола.
- **monitorLink**: URL, на который отправляются обновления статуса в Uptime Kuma.

## Планы

- Prometheus-совместимый эндпоинт метрик

## Contributing

Так как это бета-версия, есть много возможностей для улучшения. Если вы столкнетесь с проблемами или у вас есть предложения, не стесняйтесь открыть issue или отправить pull request.

## Disclaimer

Это программное обеспечение все еще находится в разработке. Используйте его на свой страх и риск. Разработчики не несут ответственности за любые повреждения или проблемы, вызванные использованием этого инструмента.
